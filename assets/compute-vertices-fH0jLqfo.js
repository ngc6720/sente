(function(){"use strict";/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Jt="160";const $t=300;const Qt=1e3;const ft=1001;const Kt=1002;const ti=1003;const yi=1006;const xi=1008;const pi=1009;const fi=1014;const gi=1015;const _i=1020;const Mi=1023;const It=1026;const ii=1027;const bi=3e3;const Ut=3001;const Pt="";const Nt="srgb";const zi=515;const ei=35044;const gt=2e3;const si=2001;class Ot{addEventListener(t,i){if(this._listeners===void 0)this._listeners={};const e=this._listeners;if(e[t]===void 0){e[t]=[]}if(e[t].indexOf(i)===-1){e[t].push(i)}}hasEventListener(t,i){if(this._listeners===void 0)return false;const e=this._listeners;return e[t]!==void 0&&e[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const e=this._listeners;const s=e[t];if(s!==void 0){const n=s.indexOf(i);if(n!==-1){s.splice(n,1)}}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners;const e=i[t.type];if(e!==void 0){t.target=this;const s=e.slice(0);for(let n=0,u=s.length;n<u;n++){s[n].call(this,t)}t.target=null}}}const k=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function _t(){const f=Math.random()*4294967295|0;const t=Math.random()*4294967295|0;const i=Math.random()*4294967295|0;const e=Math.random()*4294967295|0;const s=k[f&255]+k[f>>8&255]+k[f>>16&255]+k[f>>24&255]+"-"+k[t&255]+k[t>>8&255]+"-"+k[t>>16&15|64]+k[t>>24&255]+"-"+k[i&63|128]+k[i>>8&255]+"-"+k[i>>16&255]+k[i>>24&255]+k[e&255]+k[e>>8&255]+k[e>>16&255]+k[e>>24&255];return s.toLowerCase()}function W(f,t,i){return Math.max(t,Math.min(i,f))}function lt(f,t){switch(t.constructor){case Float32Array:return f;case Uint32Array:return f/4294967295;case Uint16Array:return f/65535;case Uint8Array:return f/255;case Int32Array:return Math.max(f/2147483647,-1);case Int16Array:return Math.max(f/32767,-1);case Int8Array:return Math.max(f/127,-1);default:throw new Error("Invalid component type.")}}function I(f,t){switch(t.constructor){case Float32Array:return f;case Uint32Array:return Math.round(f*4294967295);case Uint16Array:return Math.round(f*65535);case Uint8Array:return Math.round(f*255);case Int32Array:return Math.round(f*2147483647);case Int16Array:return Math.round(f*32767);case Int8Array:return Math.round(f*127);default:throw new Error("Invalid component type.")}}class L{constructor(t=0,i=0){L.prototype.isVector2=true;this.x=t;this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){this.x=t;this.y=i;return this}setScalar(t){this.x=t;this.y=t;return this}setX(t){this.x=t;return this}setY(t){this.y=t;return this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){this.x=t.x;this.y=t.y;return this}add(t){this.x+=t.x;this.y+=t.y;return this}addScalar(t){this.x+=t;this.y+=t;return this}addVectors(t,i){this.x=t.x+i.x;this.y=t.y+i.y;return this}addScaledVector(t,i){this.x+=t.x*i;this.y+=t.y*i;return this}sub(t){this.x-=t.x;this.y-=t.y;return this}subScalar(t){this.x-=t;this.y-=t;return this}subVectors(t,i){this.x=t.x-i.x;this.y=t.y-i.y;return this}multiply(t){this.x*=t.x;this.y*=t.y;return this}multiplyScalar(t){this.x*=t;this.y*=t;return this}divide(t){this.x/=t.x;this.y/=t.y;return this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const i=this.x,e=this.y;const s=t.elements;this.x=s[0]*i+s[3]*e+s[6];this.y=s[1]*i+s[4]*e+s[7];return this}min(t){this.x=Math.min(this.x,t.x);this.y=Math.min(this.y,t.y);return this}max(t){this.x=Math.max(this.x,t.x);this.y=Math.max(this.y,t.y);return this}clamp(t,i){this.x=Math.max(t.x,Math.min(i.x,this.x));this.y=Math.max(t.y,Math.min(i.y,this.y));return this}clampScalar(t,i){this.x=Math.max(t,Math.min(i,this.x));this.y=Math.max(t,Math.min(i,this.y));return this}clampLength(t,i){const e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(i,e)))}floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this}ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this}round(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this}roundToZero(){this.x=Math.trunc(this.x);this.y=Math.trunc(this.y);return this}negate(){this.x=-this.x;this.y=-this.y;return this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){const t=Math.atan2(-this.y,-this.x)+Math.PI;return t}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const e=this.dot(t)/i;return Math.acos(W(e,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,e=this.y-t.y;return i*i+e*e}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){this.x+=(t.x-this.x)*i;this.y+=(t.y-this.y)*i;return this}lerpVectors(t,i,e){this.x=t.x+(i.x-t.x)*e;this.y=t.y+(i.y-t.y)*e;return this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){this.x=t[i];this.y=t[i+1];return this}toArray(t=[],i=0){t[i]=this.x;t[i+1]=this.y;return t}fromBufferAttribute(t,i){this.x=t.getX(i);this.y=t.getY(i);return this}rotateAround(t,i){const e=Math.cos(i),s=Math.sin(i);const n=this.x-t.x;const u=this.y-t.y;this.x=n*e-u*s+t.x;this.y=n*s+u*e+t.y;return this}random(){this.x=Math.random();this.y=Math.random();return this}*[Symbol.iterator](){yield this.x;yield this.y}}class it{constructor(t,i,e,s,n,u,h,r,a){it.prototype.isMatrix3=true;this.elements=[1,0,0,0,1,0,0,0,1];if(t!==void 0){this.set(t,i,e,s,n,u,h,r,a)}}set(t,i,e,s,n,u,h,r,a){const o=this.elements;o[0]=t;o[1]=s;o[2]=h;o[3]=i;o[4]=n;o[5]=r;o[6]=e;o[7]=u;o[8]=a;return this}identity(){this.set(1,0,0,0,1,0,0,0,1);return this}copy(t){const i=this.elements;const e=t.elements;i[0]=e[0];i[1]=e[1];i[2]=e[2];i[3]=e[3];i[4]=e[4];i[5]=e[5];i[6]=e[6];i[7]=e[7];i[8]=e[8];return this}extractBasis(t,i,e){t.setFromMatrix3Column(this,0);i.setFromMatrix3Column(this,1);e.setFromMatrix3Column(this,2);return this}setFromMatrix4(t){const i=t.elements;this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]);return this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const e=t.elements;const s=i.elements;const n=this.elements;const u=e[0],h=e[3],r=e[6];const a=e[1],o=e[4],l=e[7];const d=e[2],c=e[5],m=e[8];const y=s[0],g=s[3],x=s[6];const b=s[1],A=s[4],z=s[7];const M=s[2],S=s[5],_=s[8];n[0]=u*y+h*b+r*M;n[3]=u*g+h*A+r*S;n[6]=u*x+h*z+r*_;n[1]=a*y+o*b+l*M;n[4]=a*g+o*A+l*S;n[7]=a*x+o*z+l*_;n[2]=d*y+c*b+m*M;n[5]=d*g+c*A+m*S;n[8]=d*x+c*z+m*_;return this}multiplyScalar(t){const i=this.elements;i[0]*=t;i[3]*=t;i[6]*=t;i[1]*=t;i[4]*=t;i[7]*=t;i[2]*=t;i[5]*=t;i[8]*=t;return this}determinant(){const t=this.elements;const i=t[0],e=t[1],s=t[2],n=t[3],u=t[4],h=t[5],r=t[6],a=t[7],o=t[8];return i*u*o-i*h*a-e*n*o+e*h*r+s*n*a-s*u*r}invert(){const t=this.elements,i=t[0],e=t[1],s=t[2],n=t[3],u=t[4],h=t[5],r=t[6],a=t[7],o=t[8],l=o*u-h*a,d=h*r-o*n,c=a*n-u*r,m=i*l+e*d+s*c;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/m;t[0]=l*y;t[1]=(s*a-o*e)*y;t[2]=(h*e-s*u)*y;t[3]=d*y;t[4]=(o*i-s*r)*y;t[5]=(s*n-h*i)*y;t[6]=c*y;t[7]=(e*r-a*i)*y;t[8]=(u*i-e*n)*y;return this}transpose(){let t;const i=this.elements;t=i[1];i[1]=i[3];i[3]=t;t=i[2];i[2]=i[6];i[6]=t;t=i[5];i[5]=i[7];i[7]=t;return this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const i=this.elements;t[0]=i[0];t[1]=i[3];t[2]=i[6];t[3]=i[1];t[4]=i[4];t[5]=i[7];t[6]=i[2];t[7]=i[5];t[8]=i[8];return this}setUvTransform(t,i,e,s,n,u,h){const r=Math.cos(n);const a=Math.sin(n);this.set(e*r,e*a,-e*(r*u+a*h)+u+t,-s*a,s*r,-s*(-a*u+r*h)+h+i,0,0,1);return this}scale(t,i){this.premultiply(qt.makeScale(t,i));return this}rotate(t){this.premultiply(qt.makeRotation(-t));return this}translate(t,i){this.premultiply(qt.makeTranslation(t,i));return this}makeTranslation(t,i){if(t.isVector2){this.set(1,0,t.x,0,1,t.y,0,0,1)}else{this.set(1,0,t,0,1,i,0,0,1)}return this}makeRotation(t){const i=Math.cos(t);const e=Math.sin(t);this.set(i,-e,0,e,i,0,0,0,1);return this}makeScale(t,i){this.set(t,0,0,0,i,0,0,0,1);return this}equals(t){const i=this.elements;const e=t.elements;for(let s=0;s<9;s++){if(i[s]!==e[s])return false}return true}fromArray(t,i=0){for(let e=0;e<9;e++){this.elements[e]=t[e+i]}return this}toArray(t=[],i=0){const e=this.elements;t[i]=e[0];t[i+1]=e[1];t[i+2]=e[2];t[i+3]=e[3];t[i+4]=e[4];t[i+5]=e[5];t[i+6]=e[6];t[i+7]=e[7];t[i+8]=e[8];return t}clone(){return new this.constructor().fromArray(this.elements)}}const qt=new it;function wi(f){for(let t=f.length-1;t>=0;--t){if(f[t]>=65535)return true}return false}function ni(f){return document.createElementNS("http://www.w3.org/1999/xhtml",f)}const ri={};function Dt(f){if(f in ri)return;ri[f]=true;console.warn(f)}function Wt(f){return f<.04045?f*.0773993808:Math.pow(f*.9478672986+.0521327014,2.4)}let et;class Ai{static getDataURL(t){if(/^data:/i.test(t.src)){return t.src}if(typeof HTMLCanvasElement==="undefined"){return t.src}let i;if(t instanceof HTMLCanvasElement){i=t}else{if(et===void 0)et=ni("canvas");et.width=t.width;et.height=t.height;const e=et.getContext("2d");if(t instanceof ImageData){e.putImageData(t,0,0)}else{e.drawImage(t,0,0,t.width,t.height)}i=et}if(i.width>2048||i.height>2048){console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t);return i.toDataURL("image/jpeg",.6)}else{return i.toDataURL("image/png")}}static sRGBToLinear(t){if(typeof HTMLImageElement!=="undefined"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement!=="undefined"&&t instanceof HTMLCanvasElement||typeof ImageBitmap!=="undefined"&&t instanceof ImageBitmap){const i=ni("canvas");i.width=t.width;i.height=t.height;const e=i.getContext("2d");e.drawImage(t,0,0,t.width,t.height);const s=e.getImageData(0,0,t.width,t.height);const n=s.data;for(let u=0;u<n.length;u++){n[u]=Wt(n[u]/255)*255}e.putImageData(s,0,0);return i}else if(t.data){const i=t.data.slice(0);for(let e=0;e<i.length;e++){if(i instanceof Uint8Array||i instanceof Uint8ClampedArray){i[e]=Math.floor(Wt(i[e]/255)*255)}else{i[e]=Wt(i[e])}}return{data:i,width:t.width,height:t.height}}else{console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied.");return t}}}let Si=0;class Bi{constructor(t=null){this.isSource=true;Object.defineProperty(this,"id",{value:Si++});this.uuid=_t();this.data=t;this.version=0}set needsUpdate(t){if(t===true)this.version++}toJSON(t){const i=t===void 0||typeof t==="string";if(!i&&t.images[this.uuid]!==void 0){return t.images[this.uuid]}const e={uuid:this.uuid,url:""};const s=this.data;if(s!==null){let n;if(Array.isArray(s)){n=[];for(let u=0,h=s.length;u<h;u++){if(s[u].isDataTexture){n.push(Lt(s[u].image))}else{n.push(Lt(s[u]))}}}else{n=Lt(s)}e.url=n}if(!i){t.images[this.uuid]=e}return e}}function Lt(f){if(typeof HTMLImageElement!=="undefined"&&f instanceof HTMLImageElement||typeof HTMLCanvasElement!=="undefined"&&f instanceof HTMLCanvasElement||typeof ImageBitmap!=="undefined"&&f instanceof ImageBitmap){return Ai.getDataURL(f)}else{if(f.data){return{data:Array.from(f.data),width:f.width,height:f.height,type:f.data.constructor.name}}else{console.warn("THREE.Texture: Unable to serialize Texture.");return{}}}}let Ei=0;class V extends Ot{constructor(t=V.DEFAULT_IMAGE,i=V.DEFAULT_MAPPING,e=ft,s=ft,n=yi,u=xi,h=Mi,r=pi,a=V.DEFAULT_ANISOTROPY,o=Pt){super();this.isTexture=true;Object.defineProperty(this,"id",{value:Ei++});this.uuid=_t();this.name="";this.source=new Bi(t);this.mipmaps=[];this.mapping=i;this.channel=0;this.wrapS=e;this.wrapT=s;this.magFilter=n;this.minFilter=u;this.anisotropy=a;this.format=h;this.internalFormat=null;this.type=r;this.offset=new L(0,0);this.repeat=new L(1,1);this.center=new L(0,0);this.rotation=0;this.matrixAutoUpdate=true;this.matrix=new it;this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;if(typeof o==="string"){this.colorSpace=o}else{Dt("THREE.Texture: Property .encoding has been replaced by .colorSpace.");this.colorSpace=o===Ut?Nt:Pt}this.userData={};this.version=0;this.onUpdate=null;this.isRenderTargetTexture=false;this.needsPMREMUpdate=false}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name;this.source=t.source;this.mipmaps=t.mipmaps.slice(0);this.mapping=t.mapping;this.channel=t.channel;this.wrapS=t.wrapS;this.wrapT=t.wrapT;this.magFilter=t.magFilter;this.minFilter=t.minFilter;this.anisotropy=t.anisotropy;this.format=t.format;this.internalFormat=t.internalFormat;this.type=t.type;this.offset.copy(t.offset);this.repeat.copy(t.repeat);this.center.copy(t.center);this.rotation=t.rotation;this.matrixAutoUpdate=t.matrixAutoUpdate;this.matrix.copy(t.matrix);this.generateMipmaps=t.generateMipmaps;this.premultiplyAlpha=t.premultiplyAlpha;this.flipY=t.flipY;this.unpackAlignment=t.unpackAlignment;this.colorSpace=t.colorSpace;this.userData=JSON.parse(JSON.stringify(t.userData));this.needsUpdate=true;return this}toJSON(t){const i=t===void 0||typeof t==="string";if(!i&&t.textures[this.uuid]!==void 0){return t.textures[this.uuid]}const e={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(Object.keys(this.userData).length>0)e.userData=this.userData;if(!i){t.textures[this.uuid]=e}return e}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==$t)return t;t.applyMatrix3(this.matrix);if(t.x<0||t.x>1){switch(this.wrapS){case Qt:t.x=t.x-Math.floor(t.x);break;case ft:t.x=t.x<0?0:1;break;case Kt:if(Math.abs(Math.floor(t.x)%2)===1){t.x=Math.ceil(t.x)-t.x}else{t.x=t.x-Math.floor(t.x)}break}}if(t.y<0||t.y>1){switch(this.wrapT){case Qt:t.y=t.y-Math.floor(t.y);break;case ft:t.y=t.y<0?0:1;break;case Kt:if(Math.abs(Math.floor(t.y)%2)===1){t.y=Math.ceil(t.y)-t.y}else{t.y=t.y-Math.floor(t.y)}break}}if(this.flipY){t.y=1-t.y}return t}set needsUpdate(t){if(t===true){this.version++;this.source.needsUpdate=true}}get encoding(){Dt("THREE.Texture: Property .encoding has been replaced by .colorSpace.");return this.colorSpace===Nt?Ut:bi}set encoding(t){Dt("THREE.Texture: Property .encoding has been replaced by .colorSpace.");this.colorSpace=t===Ut?Nt:Pt}}V.DEFAULT_IMAGE=null;V.DEFAULT_MAPPING=$t;V.DEFAULT_ANISOTROPY=1;class ct{constructor(t=0,i=0,e=0,s=1){this.isQuaternion=true;this._x=t;this._y=i;this._z=e;this._w=s}static slerpFlat(t,i,e,s,n,u,h){let r=e[s+0],a=e[s+1],o=e[s+2],l=e[s+3];const d=n[u+0],c=n[u+1],m=n[u+2],y=n[u+3];if(h===0){t[i+0]=r;t[i+1]=a;t[i+2]=o;t[i+3]=l;return}if(h===1){t[i+0]=d;t[i+1]=c;t[i+2]=m;t[i+3]=y;return}if(l!==y||r!==d||a!==c||o!==m){let g=1-h;const x=r*d+a*c+o*m+l*y,b=x>=0?1:-1,A=1-x*x;if(A>Number.EPSILON){const M=Math.sqrt(A),S=Math.atan2(M,x*b);g=Math.sin(g*S)/M;h=Math.sin(h*S)/M}const z=h*b;r=r*g+d*z;a=a*g+c*z;o=o*g+m*z;l=l*g+y*z;if(g===1-h){const M=1/Math.sqrt(r*r+a*a+o*o+l*l);r*=M;a*=M;o*=M;l*=M}}t[i]=r;t[i+1]=a;t[i+2]=o;t[i+3]=l}static multiplyQuaternionsFlat(t,i,e,s,n,u){const h=e[s];const r=e[s+1];const a=e[s+2];const o=e[s+3];const l=n[u];const d=n[u+1];const c=n[u+2];const m=n[u+3];t[i]=h*m+o*l+r*c-a*d;t[i+1]=r*m+o*d+a*l-h*c;t[i+2]=a*m+o*c+h*d-r*l;t[i+3]=o*m-h*l-r*d-a*c;return t}get x(){return this._x}set x(t){this._x=t;this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t;this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t;this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t;this._onChangeCallback()}set(t,i,e,s){this._x=t;this._y=i;this._z=e;this._w=s;this._onChangeCallback();return this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){this._x=t.x;this._y=t.y;this._z=t.z;this._w=t.w;this._onChangeCallback();return this}setFromEuler(t,i=true){const e=t._x,s=t._y,n=t._z,u=t._order;const h=Math.cos;const r=Math.sin;const a=h(e/2);const o=h(s/2);const l=h(n/2);const d=r(e/2);const c=r(s/2);const m=r(n/2);switch(u){case"XYZ":this._x=d*o*l+a*c*m;this._y=a*c*l-d*o*m;this._z=a*o*m+d*c*l;this._w=a*o*l-d*c*m;break;case"YXZ":this._x=d*o*l+a*c*m;this._y=a*c*l-d*o*m;this._z=a*o*m-d*c*l;this._w=a*o*l+d*c*m;break;case"ZXY":this._x=d*o*l-a*c*m;this._y=a*c*l+d*o*m;this._z=a*o*m+d*c*l;this._w=a*o*l-d*c*m;break;case"ZYX":this._x=d*o*l-a*c*m;this._y=a*c*l+d*o*m;this._z=a*o*m-d*c*l;this._w=a*o*l+d*c*m;break;case"YZX":this._x=d*o*l+a*c*m;this._y=a*c*l+d*o*m;this._z=a*o*m-d*c*l;this._w=a*o*l-d*c*m;break;case"XZY":this._x=d*o*l-a*c*m;this._y=a*c*l-d*o*m;this._z=a*o*m+d*c*l;this._w=a*o*l+d*c*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+u)}if(i===true)this._onChangeCallback();return this}setFromAxisAngle(t,i){const e=i/2,s=Math.sin(e);this._x=t.x*s;this._y=t.y*s;this._z=t.z*s;this._w=Math.cos(e);this._onChangeCallback();return this}setFromRotationMatrix(t){const i=t.elements,e=i[0],s=i[4],n=i[8],u=i[1],h=i[5],r=i[9],a=i[2],o=i[6],l=i[10],d=e+h+l;if(d>0){const c=.5/Math.sqrt(d+1);this._w=.25/c;this._x=(o-r)*c;this._y=(n-a)*c;this._z=(u-s)*c}else if(e>h&&e>l){const c=2*Math.sqrt(1+e-h-l);this._w=(o-r)/c;this._x=.25*c;this._y=(s+u)/c;this._z=(n+a)/c}else if(h>l){const c=2*Math.sqrt(1+h-e-l);this._w=(n-a)/c;this._x=(s+u)/c;this._y=.25*c;this._z=(r+o)/c}else{const c=2*Math.sqrt(1+l-e-h);this._w=(u-s)/c;this._x=(n+a)/c;this._y=(r+o)/c;this._z=.25*c}this._onChangeCallback();return this}setFromUnitVectors(t,i){let e=t.dot(i)+1;if(e<Number.EPSILON){e=0;if(Math.abs(t.x)>Math.abs(t.z)){this._x=-t.y;this._y=t.x;this._z=0;this._w=e}else{this._x=0;this._y=-t.z;this._z=t.y;this._w=e}}else{this._x=t.y*i.z-t.z*i.y;this._y=t.z*i.x-t.x*i.z;this._z=t.x*i.y-t.y*i.x;this._w=e}return this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(W(this.dot(t),-1,1)))}rotateTowards(t,i){const e=this.angleTo(t);if(e===0)return this;const s=Math.min(1,i/e);this.slerp(t,s);return this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){this._x*=-1;this._y*=-1;this._z*=-1;this._onChangeCallback();return this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();if(t===0){this._x=0;this._y=0;this._z=0;this._w=1}else{t=1/t;this._x=this._x*t;this._y=this._y*t;this._z=this._z*t;this._w=this._w*t}this._onChangeCallback();return this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const e=t._x,s=t._y,n=t._z,u=t._w;const h=i._x,r=i._y,a=i._z,o=i._w;this._x=e*o+u*h+s*a-n*r;this._y=s*o+u*r+n*h-e*a;this._z=n*o+u*a+e*r-s*h;this._w=u*o-e*h-s*r-n*a;this._onChangeCallback();return this}slerp(t,i){if(i===0)return this;if(i===1)return this.copy(t);const e=this._x,s=this._y,n=this._z,u=this._w;let h=u*t._w+e*t._x+s*t._y+n*t._z;if(h<0){this._w=-t._w;this._x=-t._x;this._y=-t._y;this._z=-t._z;h=-h}else{this.copy(t)}if(h>=1){this._w=u;this._x=e;this._y=s;this._z=n;return this}const r=1-h*h;if(r<=Number.EPSILON){const c=1-i;this._w=c*u+i*this._w;this._x=c*e+i*this._x;this._y=c*s+i*this._y;this._z=c*n+i*this._z;this.normalize();return this}const a=Math.sqrt(r);const o=Math.atan2(a,h);const l=Math.sin((1-i)*o)/a,d=Math.sin(i*o)/a;this._w=u*l+this._w*d;this._x=e*l+this._x*d;this._y=s*l+this._y*d;this._z=n*l+this._z*d;this._onChangeCallback();return this}slerpQuaternions(t,i,e){return this.copy(t).slerp(i,e)}random(){const t=Math.random();const i=Math.sqrt(1-t);const e=Math.sqrt(t);const s=2*Math.PI*Math.random();const n=2*Math.PI*Math.random();return this.set(i*Math.cos(s),e*Math.sin(n),e*Math.cos(n),i*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){this._x=t[i];this._y=t[i+1];this._z=t[i+2];this._w=t[i+3];this._onChangeCallback();return this}toArray(t=[],i=0){t[i]=this._x;t[i+1]=this._y;t[i+2]=this._z;t[i+3]=this._w;return t}fromBufferAttribute(t,i){this._x=t.getX(i);this._y=t.getY(i);this._z=t.getZ(i);this._w=t.getW(i);this._onChangeCallback();return this}toJSON(){return this.toArray()}_onChange(t){this._onChangeCallback=t;return this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x;yield this._y;yield this._z;yield this._w}}class p{constructor(t=0,i=0,e=0){p.prototype.isVector3=true;this.x=t;this.y=i;this.z=e}set(t,i,e){if(e===void 0)e=this.z;this.x=t;this.y=i;this.z=e;return this}setScalar(t){this.x=t;this.y=t;this.z=t;return this}setX(t){this.x=t;return this}setY(t){this.y=t;return this}setZ(t){this.z=t;return this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){this.x=t.x;this.y=t.y;this.z=t.z;return this}add(t){this.x+=t.x;this.y+=t.y;this.z+=t.z;return this}addScalar(t){this.x+=t;this.y+=t;this.z+=t;return this}addVectors(t,i){this.x=t.x+i.x;this.y=t.y+i.y;this.z=t.z+i.z;return this}addScaledVector(t,i){this.x+=t.x*i;this.y+=t.y*i;this.z+=t.z*i;return this}sub(t){this.x-=t.x;this.y-=t.y;this.z-=t.z;return this}subScalar(t){this.x-=t;this.y-=t;this.z-=t;return this}subVectors(t,i){this.x=t.x-i.x;this.y=t.y-i.y;this.z=t.z-i.z;return this}multiply(t){this.x*=t.x;this.y*=t.y;this.z*=t.z;return this}multiplyScalar(t){this.x*=t;this.y*=t;this.z*=t;return this}multiplyVectors(t,i){this.x=t.x*i.x;this.y=t.y*i.y;this.z=t.z*i.z;return this}applyEuler(t){return this.applyQuaternion(hi.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(hi.setFromAxisAngle(t,i))}applyMatrix3(t){const i=this.x,e=this.y,s=this.z;const n=t.elements;this.x=n[0]*i+n[3]*e+n[6]*s;this.y=n[1]*i+n[4]*e+n[7]*s;this.z=n[2]*i+n[5]*e+n[8]*s;return this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const i=this.x,e=this.y,s=this.z;const n=t.elements;const u=1/(n[3]*i+n[7]*e+n[11]*s+n[15]);this.x=(n[0]*i+n[4]*e+n[8]*s+n[12])*u;this.y=(n[1]*i+n[5]*e+n[9]*s+n[13])*u;this.z=(n[2]*i+n[6]*e+n[10]*s+n[14])*u;return this}applyQuaternion(t){const i=this.x,e=this.y,s=this.z;const n=t.x,u=t.y,h=t.z,r=t.w;const a=2*(u*s-h*e);const o=2*(h*i-n*s);const l=2*(n*e-u*i);this.x=i+r*a+u*l-h*o;this.y=e+r*o+h*a-n*l;this.z=s+r*l+n*o-u*a;return this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const i=this.x,e=this.y,s=this.z;const n=t.elements;this.x=n[0]*i+n[4]*e+n[8]*s;this.y=n[1]*i+n[5]*e+n[9]*s;this.z=n[2]*i+n[6]*e+n[10]*s;return this.normalize()}divide(t){this.x/=t.x;this.y/=t.y;this.z/=t.z;return this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){this.x=Math.min(this.x,t.x);this.y=Math.min(this.y,t.y);this.z=Math.min(this.z,t.z);return this}max(t){this.x=Math.max(this.x,t.x);this.y=Math.max(this.y,t.y);this.z=Math.max(this.z,t.z);return this}clamp(t,i){this.x=Math.max(t.x,Math.min(i.x,this.x));this.y=Math.max(t.y,Math.min(i.y,this.y));this.z=Math.max(t.z,Math.min(i.z,this.z));return this}clampScalar(t,i){this.x=Math.max(t,Math.min(i,this.x));this.y=Math.max(t,Math.min(i,this.y));this.z=Math.max(t,Math.min(i,this.z));return this}clampLength(t,i){const e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(i,e)))}floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this}ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this}round(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this}roundToZero(){this.x=Math.trunc(this.x);this.y=Math.trunc(this.y);this.z=Math.trunc(this.z);return this}negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){this.x+=(t.x-this.x)*i;this.y+=(t.y-this.y)*i;this.z+=(t.z-this.z)*i;return this}lerpVectors(t,i,e){this.x=t.x+(i.x-t.x)*e;this.y=t.y+(i.y-t.y)*e;this.z=t.z+(i.z-t.z)*e;return this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){const e=t.x,s=t.y,n=t.z;const u=i.x,h=i.y,r=i.z;this.x=s*r-n*h;this.y=n*u-e*r;this.z=e*h-s*u;return this}projectOnVector(t){const i=t.lengthSq();if(i===0)return this.set(0,0,0);const e=t.dot(this)/i;return this.copy(t).multiplyScalar(e)}projectOnPlane(t){Yt.copy(this).projectOnVector(t);return this.sub(Yt)}reflect(t){return this.sub(Yt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const e=this.dot(t)/i;return Math.acos(W(e,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,e=this.y-t.y,s=this.z-t.z;return i*i+e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,e){const s=Math.sin(i)*t;this.x=s*Math.sin(e);this.y=Math.cos(i)*t;this.z=s*Math.cos(e);return this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,e){this.x=t*Math.sin(i);this.y=e;this.z=t*Math.cos(i);return this}setFromMatrixPosition(t){const i=t.elements;this.x=i[12];this.y=i[13];this.z=i[14];return this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length();const e=this.setFromMatrixColumn(t,1).length();const s=this.setFromMatrixColumn(t,2).length();this.x=i;this.y=e;this.z=s;return this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}setFromEuler(t){this.x=t._x;this.y=t._y;this.z=t._z;return this}setFromColor(t){this.x=t.r;this.y=t.g;this.z=t.b;return this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){this.x=t[i];this.y=t[i+1];this.z=t[i+2];return this}toArray(t=[],i=0){t[i]=this.x;t[i+1]=this.y;t[i+2]=this.z;return t}fromBufferAttribute(t,i){this.x=t.getX(i);this.y=t.getY(i);this.z=t.getZ(i);return this}random(){this.x=Math.random();this.y=Math.random();this.z=Math.random();return this}randomDirection(){const t=(Math.random()-.5)*2;const i=Math.random()*Math.PI*2;const e=Math.sqrt(1-t**2);this.x=e*Math.cos(i);this.y=e*Math.sin(i);this.z=t;return this}*[Symbol.iterator](){yield this.x;yield this.y;yield this.z}}const Yt=new p;const hi=new ct;class dt{constructor(t=new p(Infinity,Infinity,Infinity),i=new p(-Infinity,-Infinity,-Infinity)){this.isBox3=true;this.min=t;this.max=i}set(t,i){this.min.copy(t);this.max.copy(i);return this}setFromArray(t){this.makeEmpty();for(let i=0,e=t.length;i<e;i+=3){this.expandByPoint(O.fromArray(t,i))}return this}setFromBufferAttribute(t){this.makeEmpty();for(let i=0,e=t.count;i<e;i++){this.expandByPoint(O.fromBufferAttribute(t,i))}return this}setFromPoints(t){this.makeEmpty();for(let i=0,e=t.length;i<e;i++){this.expandByPoint(t[i])}return this}setFromCenterAndSize(t,i){const e=O.copy(i).multiplyScalar(.5);this.min.copy(t).sub(e);this.max.copy(t).add(e);return this}setFromObject(t,i=false){this.makeEmpty();return this.expandByObject(t,i)}clone(){return new this.constructor().copy(this)}copy(t){this.min.copy(t.min);this.max.copy(t.max);return this}makeEmpty(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){this.min.min(t);this.max.max(t);return this}expandByVector(t){this.min.sub(t);this.max.add(t);return this}expandByScalar(t){this.min.addScalar(-t);this.max.addScalar(t);return this}expandByObject(t,i=false){t.updateWorldMatrix(false,false);const e=t.geometry;if(e!==void 0){const n=e.getAttribute("position");if(i===true&&n!==void 0&&t.isInstancedMesh!==true){for(let u=0,h=n.count;u<h;u++){if(t.isMesh===true){t.getVertexPosition(u,O)}else{O.fromBufferAttribute(n,u)}O.applyMatrix4(t.matrixWorld);this.expandByPoint(O)}}else{if(t.boundingBox!==void 0){if(t.boundingBox===null){t.computeBoundingBox()}Mt.copy(t.boundingBox)}else{if(e.boundingBox===null){e.computeBoundingBox()}Mt.copy(e.boundingBox)}Mt.applyMatrix4(t.matrixWorld);this.union(Mt)}}const s=t.children;for(let n=0,u=s.length;n<u;n++){this.expandByObject(s[n],i)}return this}containsPoint(t){return t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z?false:true}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z?false:true}intersectsSphere(t){this.clampPoint(t.center,O);return O.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let i,e;if(t.normal.x>0){i=t.normal.x*this.min.x;e=t.normal.x*this.max.x}else{i=t.normal.x*this.max.x;e=t.normal.x*this.min.x}if(t.normal.y>0){i+=t.normal.y*this.min.y;e+=t.normal.y*this.max.y}else{i+=t.normal.y*this.max.y;e+=t.normal.y*this.min.y}if(t.normal.z>0){i+=t.normal.z*this.min.z;e+=t.normal.z*this.max.z}else{i+=t.normal.z*this.max.z;e+=t.normal.z*this.min.z}return i<=-t.constant&&e>=-t.constant}intersectsTriangle(t){if(this.isEmpty()){return false}this.getCenter(mt);bt.subVectors(this.max,mt);st.subVectors(t.a,mt);nt.subVectors(t.b,mt);rt.subVectors(t.c,mt);Z.subVectors(nt,st);H.subVectors(rt,nt);Q.subVectors(st,rt);let i=[0,-Z.z,Z.y,0,-H.z,H.y,0,-Q.z,Q.y,Z.z,0,-Z.x,H.z,0,-H.x,Q.z,0,-Q.x,-Z.y,Z.x,0,-H.y,H.x,0,-Q.y,Q.x,0];if(!Xt(i,st,nt,rt,bt)){return false}i=[1,0,0,0,1,0,0,0,1];if(!Xt(i,st,nt,rt,bt)){return false}zt.crossVectors(Z,H);i=[zt.x,zt.y,zt.z];return Xt(i,st,nt,rt,bt)}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,O).distanceTo(t)}getBoundingSphere(t){if(this.isEmpty()){t.makeEmpty()}else{this.getCenter(t.center);t.radius=this.getSize(O).length()*.5}return t}intersect(t){this.min.max(t.min);this.max.min(t.max);if(this.isEmpty())this.makeEmpty();return this}union(t){this.min.min(t.min);this.max.max(t.max);return this}applyMatrix4(t){if(this.isEmpty())return this;Y[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t);Y[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t);Y[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t);Y[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t);Y[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t);Y[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t);Y[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t);Y[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t);this.setFromPoints(Y);return this}translate(t){this.min.add(t);this.max.add(t);return this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Y=[new p,new p,new p,new p,new p,new p,new p,new p];const O=new p;const Mt=new dt;const st=new p;const nt=new p;const rt=new p;const Z=new p;const H=new p;const Q=new p;const mt=new p;const bt=new p;const zt=new p;const K=new p;function Xt(f,t,i,e,s){for(let n=0,u=f.length-3;n<=u;n+=3){K.fromArray(f,n);const h=s.x*Math.abs(K.x)+s.y*Math.abs(K.y)+s.z*Math.abs(K.z);const r=t.dot(K);const a=i.dot(K);const o=e.dot(K);if(Math.max(-Math.max(r,a,o),Math.min(r,a,o))>h){return false}}return true}const Ti=new dt;const yt=new p;const Vt=new p;class Ci{constructor(t=new p,i=-1){this.isSphere=true;this.center=t;this.radius=i}set(t,i){this.center.copy(t);this.radius=i;return this}setFromPoints(t,i){const e=this.center;if(i!==void 0){e.copy(i)}else{Ti.setFromPoints(t).getCenter(e)}let s=0;for(let n=0,u=t.length;n<u;n++){s=Math.max(s,e.distanceToSquared(t[n]))}this.radius=Math.sqrt(s);return this}copy(t){this.center.copy(t.center);this.radius=t.radius;return this}isEmpty(){return this.radius<0}makeEmpty(){this.center.set(0,0,0);this.radius=-1;return this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,i){const e=this.center.distanceToSquared(t);i.copy(t);if(e>this.radius*this.radius){i.sub(this.center).normalize();i.multiplyScalar(this.radius).add(this.center)}return i}getBoundingBox(t){if(this.isEmpty()){t.makeEmpty();return t}t.set(this.center,this.center);t.expandByScalar(this.radius);return t}applyMatrix4(t){this.center.applyMatrix4(t);this.radius=this.radius*t.getMaxScaleOnAxis();return this}translate(t){this.center.add(t);return this}expandByPoint(t){if(this.isEmpty()){this.center.copy(t);this.radius=0;return this}yt.subVectors(t,this.center);const i=yt.lengthSq();if(i>this.radius*this.radius){const e=Math.sqrt(i);const s=(e-this.radius)*.5;this.center.addScaledVector(yt,s/e);this.radius+=s}return this}union(t){if(t.isEmpty()){return this}if(this.isEmpty()){this.copy(t);return this}if(this.center.equals(t.center)===true){this.radius=Math.max(this.radius,t.radius)}else{Vt.subVectors(t.center,this.center).setLength(t.radius);this.expandByPoint(yt.copy(t.center).add(Vt));this.expandByPoint(yt.copy(t.center).sub(Vt))}return this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}class D{constructor(t,i,e,s,n,u,h,r,a,o,l,d,c,m,y,g){D.prototype.isMatrix4=true;this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(t!==void 0){this.set(t,i,e,s,n,u,h,r,a,o,l,d,c,m,y,g)}}set(t,i,e,s,n,u,h,r,a,o,l,d,c,m,y,g){const x=this.elements;x[0]=t;x[4]=i;x[8]=e;x[12]=s;x[1]=n;x[5]=u;x[9]=h;x[13]=r;x[2]=a;x[6]=o;x[10]=l;x[14]=d;x[3]=c;x[7]=m;x[11]=y;x[15]=g;return this}identity(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this}clone(){return new D().fromArray(this.elements)}copy(t){const i=this.elements;const e=t.elements;i[0]=e[0];i[1]=e[1];i[2]=e[2];i[3]=e[3];i[4]=e[4];i[5]=e[5];i[6]=e[6];i[7]=e[7];i[8]=e[8];i[9]=e[9];i[10]=e[10];i[11]=e[11];i[12]=e[12];i[13]=e[13];i[14]=e[14];i[15]=e[15];return this}copyPosition(t){const i=this.elements,e=t.elements;i[12]=e[12];i[13]=e[13];i[14]=e[14];return this}setFromMatrix3(t){const i=t.elements;this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1);return this}extractBasis(t,i,e){t.setFromMatrixColumn(this,0);i.setFromMatrixColumn(this,1);e.setFromMatrixColumn(this,2);return this}makeBasis(t,i,e){this.set(t.x,i.x,e.x,0,t.y,i.y,e.y,0,t.z,i.z,e.z,0,0,0,0,1);return this}extractRotation(t){const i=this.elements;const e=t.elements;const s=1/ht.setFromMatrixColumn(t,0).length();const n=1/ht.setFromMatrixColumn(t,1).length();const u=1/ht.setFromMatrixColumn(t,2).length();i[0]=e[0]*s;i[1]=e[1]*s;i[2]=e[2]*s;i[3]=0;i[4]=e[4]*n;i[5]=e[5]*n;i[6]=e[6]*n;i[7]=0;i[8]=e[8]*u;i[9]=e[9]*u;i[10]=e[10]*u;i[11]=0;i[12]=0;i[13]=0;i[14]=0;i[15]=1;return this}makeRotationFromEuler(t){const i=this.elements;const e=t.x,s=t.y,n=t.z;const u=Math.cos(e),h=Math.sin(e);const r=Math.cos(s),a=Math.sin(s);const o=Math.cos(n),l=Math.sin(n);if(t.order==="XYZ"){const d=u*o,c=u*l,m=h*o,y=h*l;i[0]=r*o;i[4]=-r*l;i[8]=a;i[1]=c+m*a;i[5]=d-y*a;i[9]=-h*r;i[2]=y-d*a;i[6]=m+c*a;i[10]=u*r}else if(t.order==="YXZ"){const d=r*o,c=r*l,m=a*o,y=a*l;i[0]=d+y*h;i[4]=m*h-c;i[8]=u*a;i[1]=u*l;i[5]=u*o;i[9]=-h;i[2]=c*h-m;i[6]=y+d*h;i[10]=u*r}else if(t.order==="ZXY"){const d=r*o,c=r*l,m=a*o,y=a*l;i[0]=d-y*h;i[4]=-u*l;i[8]=m+c*h;i[1]=c+m*h;i[5]=u*o;i[9]=y-d*h;i[2]=-u*a;i[6]=h;i[10]=u*r}else if(t.order==="ZYX"){const d=u*o,c=u*l,m=h*o,y=h*l;i[0]=r*o;i[4]=m*a-c;i[8]=d*a+y;i[1]=r*l;i[5]=y*a+d;i[9]=c*a-m;i[2]=-a;i[6]=h*r;i[10]=u*r}else if(t.order==="YZX"){const d=u*r,c=u*a,m=h*r,y=h*a;i[0]=r*o;i[4]=y-d*l;i[8]=m*l+c;i[1]=l;i[5]=u*o;i[9]=-h*o;i[2]=-a*o;i[6]=c*l+m;i[10]=d-y*l}else if(t.order==="XZY"){const d=u*r,c=u*a,m=h*r,y=h*a;i[0]=r*o;i[4]=-l;i[8]=a*o;i[1]=d*l+y;i[5]=u*o;i[9]=c*l-m;i[2]=m*l-c;i[6]=h*o;i[10]=y*l+d}i[3]=0;i[7]=0;i[11]=0;i[12]=0;i[13]=0;i[14]=0;i[15]=1;return this}makeRotationFromQuaternion(t){return this.compose(ki,t,Ri)}lookAt(t,i,e){const s=this.elements;U.subVectors(t,i);if(U.lengthSq()===0){U.z=1}U.normalize();j.crossVectors(e,U);if(j.lengthSq()===0){if(Math.abs(e.z)===1){U.x+=1e-4}else{U.z+=1e-4}U.normalize();j.crossVectors(e,U)}j.normalize();wt.crossVectors(U,j);s[0]=j.x;s[4]=wt.x;s[8]=U.x;s[1]=j.y;s[5]=wt.y;s[9]=U.y;s[2]=j.z;s[6]=wt.z;s[10]=U.z;return this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const e=t.elements;const s=i.elements;const n=this.elements;const u=e[0],h=e[4],r=e[8],a=e[12];const o=e[1],l=e[5],d=e[9],c=e[13];const m=e[2],y=e[6],g=e[10],x=e[14];const b=e[3],A=e[7],z=e[11],M=e[15];const S=s[0],_=s[4],tt=s[8],v=s[12];const w=s[1],T=s[5],C=s[9],R=s[13];const J=s[2],F=s[6],$=s[10],Tt=s[14];const Ct=s[3],kt=s[7],Rt=s[11],Ft=s[15];n[0]=u*S+h*w+r*J+a*Ct;n[4]=u*_+h*T+r*F+a*kt;n[8]=u*tt+h*C+r*$+a*Rt;n[12]=u*v+h*R+r*Tt+a*Ft;n[1]=o*S+l*w+d*J+c*Ct;n[5]=o*_+l*T+d*F+c*kt;n[9]=o*tt+l*C+d*$+c*Rt;n[13]=o*v+l*R+d*Tt+c*Ft;n[2]=m*S+y*w+g*J+x*Ct;n[6]=m*_+y*T+g*F+x*kt;n[10]=m*tt+y*C+g*$+x*Rt;n[14]=m*v+y*R+g*Tt+x*Ft;n[3]=b*S+A*w+z*J+M*Ct;n[7]=b*_+A*T+z*F+M*kt;n[11]=b*tt+A*C+z*$+M*Rt;n[15]=b*v+A*R+z*Tt+M*Ft;return this}multiplyScalar(t){const i=this.elements;i[0]*=t;i[4]*=t;i[8]*=t;i[12]*=t;i[1]*=t;i[5]*=t;i[9]*=t;i[13]*=t;i[2]*=t;i[6]*=t;i[10]*=t;i[14]*=t;i[3]*=t;i[7]*=t;i[11]*=t;i[15]*=t;return this}determinant(){const t=this.elements;const i=t[0],e=t[4],s=t[8],n=t[12];const u=t[1],h=t[5],r=t[9],a=t[13];const o=t[2],l=t[6],d=t[10],c=t[14];const m=t[3],y=t[7],g=t[11],x=t[15];return m*(+n*r*l-s*a*l-n*h*d+e*a*d+s*h*c-e*r*c)+y*(+i*r*c-i*a*d+n*u*d-s*u*c+s*a*o-n*r*o)+g*(+i*a*l-i*h*c-n*u*l+e*u*c+n*h*o-e*a*o)+x*(-s*h*o-i*r*l+i*h*d+s*u*l-e*u*d+e*r*o)}transpose(){const t=this.elements;let i;i=t[1];t[1]=t[4];t[4]=i;i=t[2];t[2]=t[8];t[8]=i;i=t[6];t[6]=t[9];t[9]=i;i=t[3];t[3]=t[12];t[12]=i;i=t[7];t[7]=t[13];t[13]=i;i=t[11];t[11]=t[14];t[14]=i;return this}setPosition(t,i,e){const s=this.elements;if(t.isVector3){s[12]=t.x;s[13]=t.y;s[14]=t.z}else{s[12]=t;s[13]=i;s[14]=e}return this}invert(){const t=this.elements,i=t[0],e=t[1],s=t[2],n=t[3],u=t[4],h=t[5],r=t[6],a=t[7],o=t[8],l=t[9],d=t[10],c=t[11],m=t[12],y=t[13],g=t[14],x=t[15],b=l*g*a-y*d*a+y*r*c-h*g*c-l*r*x+h*d*x,A=m*d*a-o*g*a-m*r*c+u*g*c+o*r*x-u*d*x,z=o*y*a-m*l*a+m*h*c-u*y*c-o*h*x+u*l*x,M=m*l*r-o*y*r-m*h*d+u*y*d+o*h*g-u*l*g;const S=i*b+e*A+s*z+n*M;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/S;t[0]=b*_;t[1]=(y*d*n-l*g*n-y*s*c+e*g*c+l*s*x-e*d*x)*_;t[2]=(h*g*n-y*r*n+y*s*a-e*g*a-h*s*x+e*r*x)*_;t[3]=(l*r*n-h*d*n-l*s*a+e*d*a+h*s*c-e*r*c)*_;t[4]=A*_;t[5]=(o*g*n-m*d*n+m*s*c-i*g*c-o*s*x+i*d*x)*_;t[6]=(m*r*n-u*g*n-m*s*a+i*g*a+u*s*x-i*r*x)*_;t[7]=(u*d*n-o*r*n+o*s*a-i*d*a-u*s*c+i*r*c)*_;t[8]=z*_;t[9]=(m*l*n-o*y*n-m*e*c+i*y*c+o*e*x-i*l*x)*_;t[10]=(u*y*n-m*h*n+m*e*a-i*y*a-u*e*x+i*h*x)*_;t[11]=(o*h*n-u*l*n-o*e*a+i*l*a+u*e*c-i*h*c)*_;t[12]=M*_;t[13]=(o*y*s-m*l*s+m*e*d-i*y*d-o*e*g+i*l*g)*_;t[14]=(m*h*s-u*y*s-m*e*r+i*y*r+u*e*g-i*h*g)*_;t[15]=(u*l*s-o*h*s+o*e*r-i*l*r-u*e*d+i*h*d)*_;return this}scale(t){const i=this.elements;const e=t.x,s=t.y,n=t.z;i[0]*=e;i[4]*=s;i[8]*=n;i[1]*=e;i[5]*=s;i[9]*=n;i[2]*=e;i[6]*=s;i[10]*=n;i[3]*=e;i[7]*=s;i[11]*=n;return this}getMaxScaleOnAxis(){const t=this.elements;const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];const e=t[4]*t[4]+t[5]*t[5]+t[6]*t[6];const s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,e,s))}makeTranslation(t,i,e){if(t.isVector3){this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1)}else{this.set(1,0,0,t,0,1,0,i,0,0,1,e,0,0,0,1)}return this}makeRotationX(t){const i=Math.cos(t),e=Math.sin(t);this.set(1,0,0,0,0,i,-e,0,0,e,i,0,0,0,0,1);return this}makeRotationY(t){const i=Math.cos(t),e=Math.sin(t);this.set(i,0,e,0,0,1,0,0,-e,0,i,0,0,0,0,1);return this}makeRotationZ(t){const i=Math.cos(t),e=Math.sin(t);this.set(i,-e,0,0,e,i,0,0,0,0,1,0,0,0,0,1);return this}makeRotationAxis(t,i){const e=Math.cos(i);const s=Math.sin(i);const n=1-e;const u=t.x,h=t.y,r=t.z;const a=n*u,o=n*h;this.set(a*u+e,a*h-s*r,a*r+s*h,0,a*h+s*r,o*h+e,o*r-s*u,0,a*r-s*h,o*r+s*u,n*r*r+e,0,0,0,0,1);return this}makeScale(t,i,e){this.set(t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1);return this}makeShear(t,i,e,s,n,u){this.set(1,e,n,0,t,1,u,0,i,s,1,0,0,0,0,1);return this}compose(t,i,e){const s=this.elements;const n=i._x,u=i._y,h=i._z,r=i._w;const a=n+n,o=u+u,l=h+h;const d=n*a,c=n*o,m=n*l;const y=u*o,g=u*l,x=h*l;const b=r*a,A=r*o,z=r*l;const M=e.x,S=e.y,_=e.z;s[0]=(1-(y+x))*M;s[1]=(c+z)*M;s[2]=(m-A)*M;s[3]=0;s[4]=(c-z)*S;s[5]=(1-(d+x))*S;s[6]=(g+b)*S;s[7]=0;s[8]=(m+A)*_;s[9]=(g-b)*_;s[10]=(1-(d+y))*_;s[11]=0;s[12]=t.x;s[13]=t.y;s[14]=t.z;s[15]=1;return this}decompose(t,i,e){const s=this.elements;let n=ht.set(s[0],s[1],s[2]).length();const u=ht.set(s[4],s[5],s[6]).length();const h=ht.set(s[8],s[9],s[10]).length();const r=this.determinant();if(r<0)n=-n;t.x=s[12];t.y=s[13];t.z=s[14];q.copy(this);const a=1/n;const o=1/u;const l=1/h;q.elements[0]*=a;q.elements[1]*=a;q.elements[2]*=a;q.elements[4]*=o;q.elements[5]*=o;q.elements[6]*=o;q.elements[8]*=l;q.elements[9]*=l;q.elements[10]*=l;i.setFromRotationMatrix(q);e.x=n;e.y=u;e.z=h;return this}makePerspective(t,i,e,s,n,u,h=gt){const r=this.elements;const a=2*n/(i-t);const o=2*n/(e-s);const l=(i+t)/(i-t);const d=(e+s)/(e-s);let c,m;if(h===gt){c=-(u+n)/(u-n);m=-2*u*n/(u-n)}else if(h===si){c=-u/(u-n);m=-u*n/(u-n)}else{throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+h)}r[0]=a;r[4]=0;r[8]=l;r[12]=0;r[1]=0;r[5]=o;r[9]=d;r[13]=0;r[2]=0;r[6]=0;r[10]=c;r[14]=m;r[3]=0;r[7]=0;r[11]=-1;r[15]=0;return this}makeOrthographic(t,i,e,s,n,u,h=gt){const r=this.elements;const a=1/(i-t);const o=1/(e-s);const l=1/(u-n);const d=(i+t)*a;const c=(e+s)*o;let m,y;if(h===gt){m=(u+n)*l;y=-2*l}else if(h===si){m=n*l;y=-1*l}else{throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+h)}r[0]=2*a;r[4]=0;r[8]=0;r[12]=-d;r[1]=0;r[5]=2*o;r[9]=0;r[13]=-c;r[2]=0;r[6]=0;r[10]=y;r[14]=-m;r[3]=0;r[7]=0;r[11]=0;r[15]=1;return this}equals(t){const i=this.elements;const e=t.elements;for(let s=0;s<16;s++){if(i[s]!==e[s])return false}return true}fromArray(t,i=0){for(let e=0;e<16;e++){this.elements[e]=t[e+i]}return this}toArray(t=[],i=0){const e=this.elements;t[i]=e[0];t[i+1]=e[1];t[i+2]=e[2];t[i+3]=e[3];t[i+4]=e[4];t[i+5]=e[5];t[i+6]=e[6];t[i+7]=e[7];t[i+8]=e[8];t[i+9]=e[9];t[i+10]=e[10];t[i+11]=e[11];t[i+12]=e[12];t[i+13]=e[13];t[i+14]=e[14];t[i+15]=e[15];return t}}const ht=new p;const q=new D;const ki=new p(0,0,0);const Ri=new p(1,1,1);const j=new p;const wt=new p;const U=new p;const ai=new D;const oi=new ct;class At{constructor(t=0,i=0,e=0,s=At.DEFAULT_ORDER){this.isEuler=true;this._x=t;this._y=i;this._z=e;this._order=s}get x(){return this._x}set x(t){this._x=t;this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t;this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t;this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t;this._onChangeCallback()}set(t,i,e,s=this._order){this._x=t;this._y=i;this._z=e;this._order=s;this._onChangeCallback();return this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){this._x=t._x;this._y=t._y;this._z=t._z;this._order=t._order;this._onChangeCallback();return this}setFromRotationMatrix(t,i=this._order,e=true){const s=t.elements;const n=s[0],u=s[4],h=s[8];const r=s[1],a=s[5],o=s[9];const l=s[2],d=s[6],c=s[10];switch(i){case"XYZ":this._y=Math.asin(W(h,-1,1));if(Math.abs(h)<.9999999){this._x=Math.atan2(-o,c);this._z=Math.atan2(-u,n)}else{this._x=Math.atan2(d,a);this._z=0}break;case"YXZ":this._x=Math.asin(-W(o,-1,1));if(Math.abs(o)<.9999999){this._y=Math.atan2(h,c);this._z=Math.atan2(r,a)}else{this._y=Math.atan2(-l,n);this._z=0}break;case"ZXY":this._x=Math.asin(W(d,-1,1));if(Math.abs(d)<.9999999){this._y=Math.atan2(-l,c);this._z=Math.atan2(-u,a)}else{this._y=0;this._z=Math.atan2(r,n)}break;case"ZYX":this._y=Math.asin(-W(l,-1,1));if(Math.abs(l)<.9999999){this._x=Math.atan2(d,c);this._z=Math.atan2(r,n)}else{this._x=0;this._z=Math.atan2(-u,a)}break;case"YZX":this._z=Math.asin(W(r,-1,1));if(Math.abs(r)<.9999999){this._x=Math.atan2(-o,a);this._y=Math.atan2(-l,n)}else{this._x=0;this._y=Math.atan2(h,c)}break;case"XZY":this._z=Math.asin(-W(u,-1,1));if(Math.abs(u)<.9999999){this._x=Math.atan2(d,a);this._y=Math.atan2(h,n)}else{this._x=Math.atan2(-o,c);this._y=0}break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}this._order=i;if(e===true)this._onChangeCallback();return this}setFromQuaternion(t,i,e){ai.makeRotationFromQuaternion(t);return this.setFromRotationMatrix(ai,i,e)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){oi.setFromEuler(this);return this.setFromQuaternion(oi,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){this._x=t[0];this._y=t[1];this._z=t[2];if(t[3]!==void 0)this._order=t[3];this._onChangeCallback();return this}toArray(t=[],i=0){t[i]=this._x;t[i+1]=this._y;t[i+2]=this._z;t[i+3]=this._order;return t}_onChange(t){this._onChangeCallback=t;return this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x;yield this._y;yield this._z;yield this._order}}At.DEFAULT_ORDER="XYZ";class Fi{constructor(){this.mask=1|0}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=4294967295|0}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Ii=0;const ui=new p;const at=new ct;const X=new D;const St=new p;const xt=new p;const Ui=new p;const Pi=new ct;const li=new p(1,0,0);const ci=new p(0,1,0);const di=new p(0,0,1);const Ni={type:"added"};const Oi={type:"removed"};class G extends Ot{constructor(){super();this.isObject3D=true;Object.defineProperty(this,"id",{value:Ii++});this.uuid=_t();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=G.DEFAULT_UP.clone();const t=new p;const i=new At;const e=new ct;const s=new p(1,1,1);function n(){e.setFromEuler(i,false)}function u(){i.setFromQuaternion(e,void 0,false)}i._onChange(n);e._onChange(u);Object.defineProperties(this,{position:{configurable:true,enumerable:true,value:t},rotation:{configurable:true,enumerable:true,value:i},quaternion:{configurable:true,enumerable:true,value:e},scale:{configurable:true,enumerable:true,value:s},modelViewMatrix:{value:new D},normalMatrix:{value:new it}});this.matrix=new D;this.matrixWorld=new D;this.matrixAutoUpdate=G.DEFAULT_MATRIX_AUTO_UPDATE;this.matrixWorldAutoUpdate=G.DEFAULT_MATRIX_WORLD_AUTO_UPDATE;this.matrixWorldNeedsUpdate=false;this.layers=new Fi;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.renderOrder=0;this.animations=[];this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){if(this.matrixAutoUpdate)this.updateMatrix();this.matrix.premultiply(t);this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){this.quaternion.premultiply(t);return this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,true)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){at.setFromAxisAngle(t,i);this.quaternion.multiply(at);return this}rotateOnWorldAxis(t,i){at.setFromAxisAngle(t,i);this.quaternion.premultiply(at);return this}rotateX(t){return this.rotateOnAxis(li,t)}rotateY(t){return this.rotateOnAxis(ci,t)}rotateZ(t){return this.rotateOnAxis(di,t)}translateOnAxis(t,i){ui.copy(t).applyQuaternion(this.quaternion);this.position.add(ui.multiplyScalar(i));return this}translateX(t){return this.translateOnAxis(li,t)}translateY(t){return this.translateOnAxis(ci,t)}translateZ(t){return this.translateOnAxis(di,t)}localToWorld(t){this.updateWorldMatrix(true,false);return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){this.updateWorldMatrix(true,false);return t.applyMatrix4(X.copy(this.matrixWorld).invert())}lookAt(t,i,e){if(t.isVector3){St.copy(t)}else{St.set(t,i,e)}const s=this.parent;this.updateWorldMatrix(true,false);xt.setFromMatrixPosition(this.matrixWorld);if(this.isCamera||this.isLight){X.lookAt(xt,St,this.up)}else{X.lookAt(St,xt,this.up)}this.quaternion.setFromRotationMatrix(X);if(s){X.extractRotation(s.matrixWorld);at.setFromRotationMatrix(X);this.quaternion.premultiply(at.invert())}}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++){this.add(arguments[i])}return this}if(t===this){console.error("THREE.Object3D.add: object can't be added as a child of itself.",t);return this}if(t&&t.isObject3D){if(t.parent!==null){t.parent.remove(t)}t.parent=this;this.children.push(t);t.dispatchEvent(Ni)}else{console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t)}return this}remove(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++){this.remove(arguments[e])}return this}const i=this.children.indexOf(t);if(i!==-1){t.parent=null;this.children.splice(i,1);t.dispatchEvent(Oi)}return this}removeFromParent(){const t=this.parent;if(t!==null){t.remove(this)}return this}clear(){return this.remove(...this.children)}attach(t){this.updateWorldMatrix(true,false);X.copy(this.matrixWorld).invert();if(t.parent!==null){t.parent.updateWorldMatrix(true,false);X.multiply(t.parent.matrixWorld)}t.applyMatrix4(X);this.add(t);t.updateWorldMatrix(false,true);return this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let e=0,s=this.children.length;e<s;e++){const n=this.children[e];const u=n.getObjectByProperty(t,i);if(u!==void 0){return u}}return void 0}getObjectsByProperty(t,i,e=[]){if(this[t]===i)e.push(this);const s=this.children;for(let n=0,u=s.length;n<u;n++){s[n].getObjectsByProperty(t,i,e)}return e}getWorldPosition(t){this.updateWorldMatrix(true,false);return t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){this.updateWorldMatrix(true,false);this.matrixWorld.decompose(xt,t,Ui);return t}getWorldScale(t){this.updateWorldMatrix(true,false);this.matrixWorld.decompose(xt,Pi,t);return t}getWorldDirection(t){this.updateWorldMatrix(true,false);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let e=0,s=i.length;e<s;e++){i[e].traverse(t)}}traverseVisible(t){if(this.visible===false)return;t(this);const i=this.children;for(let e=0,s=i.length;e<s;e++){i[e].traverseVisible(t)}}traverseAncestors(t){const i=this.parent;if(i!==null){t(i);i.traverseAncestors(t)}}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true}updateMatrixWorld(t){if(this.matrixAutoUpdate)this.updateMatrix();if(this.matrixWorldNeedsUpdate||t){if(this.parent===null){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;t=true}const i=this.children;for(let e=0,s=i.length;e<s;e++){const n=i[e];if(n.matrixWorldAutoUpdate===true||t===true){n.updateMatrixWorld(t)}}}updateWorldMatrix(t,i){const e=this.parent;if(t===true&&e!==null&&e.matrixWorldAutoUpdate===true){e.updateWorldMatrix(true,false)}if(this.matrixAutoUpdate)this.updateMatrix();if(this.parent===null){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}if(i===true){const s=this.children;for(let n=0,u=s.length;n<u;n++){const h=s[n];if(h.matrixWorldAutoUpdate===true){h.updateWorldMatrix(false,true)}}}}toJSON(t){const i=t===void 0||typeof t==="string";const e={};if(i){t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}};e.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"}}const s={};s.uuid=this.uuid;s.type=this.type;if(this.name!=="")s.name=this.name;if(this.castShadow===true)s.castShadow=true;if(this.receiveShadow===true)s.receiveShadow=true;if(this.visible===false)s.visible=false;if(this.frustumCulled===false)s.frustumCulled=false;if(this.renderOrder!==0)s.renderOrder=this.renderOrder;if(Object.keys(this.userData).length>0)s.userData=this.userData;s.layers=this.layers.mask;s.matrix=this.matrix.toArray();s.up=this.up.toArray();if(this.matrixAutoUpdate===false)s.matrixAutoUpdate=false;if(this.isInstancedMesh){s.type="InstancedMesh";s.count=this.count;s.instanceMatrix=this.instanceMatrix.toJSON();if(this.instanceColor!==null)s.instanceColor=this.instanceColor.toJSON()}if(this.isBatchedMesh){s.type="BatchedMesh";s.perObjectFrustumCulled=this.perObjectFrustumCulled;s.sortObjects=this.sortObjects;s.drawRanges=this._drawRanges;s.reservedRanges=this._reservedRanges;s.visibility=this._visibility;s.active=this._active;s.bounds=this._bounds.map(h=>({boxInitialized:h.boxInitialized,boxMin:h.box.min.toArray(),boxMax:h.box.max.toArray(),sphereInitialized:h.sphereInitialized,sphereRadius:h.sphere.radius,sphereCenter:h.sphere.center.toArray()}));s.maxGeometryCount=this._maxGeometryCount;s.maxVertexCount=this._maxVertexCount;s.maxIndexCount=this._maxIndexCount;s.geometryInitialized=this._geometryInitialized;s.geometryCount=this._geometryCount;s.matricesTexture=this._matricesTexture.toJSON(t);if(this.boundingSphere!==null){s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}}if(this.boundingBox!==null){s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}}}function n(h,r){if(h[r.uuid]===void 0){h[r.uuid]=r.toJSON(t)}return r.uuid}if(this.isScene){if(this.background){if(this.background.isColor){s.background=this.background.toJSON()}else if(this.background.isTexture){s.background=this.background.toJSON(t).uuid}}if(this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==true){s.environment=this.environment.toJSON(t).uuid}}else if(this.isMesh||this.isLine||this.isPoints){s.geometry=n(t.geometries,this.geometry);const h=this.geometry.parameters;if(h!==void 0&&h.shapes!==void 0){const r=h.shapes;if(Array.isArray(r)){for(let a=0,o=r.length;a<o;a++){const l=r[a];n(t.shapes,l)}}else{n(t.shapes,r)}}}if(this.isSkinnedMesh){s.bindMode=this.bindMode;s.bindMatrix=this.bindMatrix.toArray();if(this.skeleton!==void 0){n(t.skeletons,this.skeleton);s.skeleton=this.skeleton.uuid}}if(this.material!==void 0){if(Array.isArray(this.material)){const h=[];for(let r=0,a=this.material.length;r<a;r++){h.push(n(t.materials,this.material[r]))}s.material=h}else{s.material=n(t.materials,this.material)}}if(this.children.length>0){s.children=[];for(let h=0;h<this.children.length;h++){s.children.push(this.children[h].toJSON(t).object)}}if(this.animations.length>0){s.animations=[];for(let h=0;h<this.animations.length;h++){const r=this.animations[h];s.animations.push(n(t.animations,r))}}if(i){const h=u(t.geometries);const r=u(t.materials);const a=u(t.textures);const o=u(t.images);const l=u(t.shapes);const d=u(t.skeletons);const c=u(t.animations);const m=u(t.nodes);if(h.length>0)e.geometries=h;if(r.length>0)e.materials=r;if(a.length>0)e.textures=a;if(o.length>0)e.images=o;if(l.length>0)e.shapes=l;if(d.length>0)e.skeletons=d;if(c.length>0)e.animations=c;if(m.length>0)e.nodes=m}e.object=s;return e;function u(h){const r=[];for(const a in h){const o=h[a];delete o.metadata;r.push(o)}return r}}clone(t){return new this.constructor().copy(this,t)}copy(t,i=true){this.name=t.name;this.up.copy(t.up);this.position.copy(t.position);this.rotation.order=t.rotation.order;this.quaternion.copy(t.quaternion);this.scale.copy(t.scale);this.matrix.copy(t.matrix);this.matrixWorld.copy(t.matrixWorld);this.matrixAutoUpdate=t.matrixAutoUpdate;this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate;this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate;this.layers.mask=t.layers.mask;this.visible=t.visible;this.castShadow=t.castShadow;this.receiveShadow=t.receiveShadow;this.frustumCulled=t.frustumCulled;this.renderOrder=t.renderOrder;this.animations=t.animations.slice();this.userData=JSON.parse(JSON.stringify(t.userData));if(i===true){for(let e=0;e<t.children.length;e++){const s=t.children[e];this.add(s.clone())}}return this}}G.DEFAULT_UP=new p(0,1,0);G.DEFAULT_MATRIX_AUTO_UPDATE=true;G.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=true;const B=new p;const Bt=new L;class ot{constructor(t,i,e=false){if(Array.isArray(t)){throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.")}this.isBufferAttribute=true;this.name="";this.array=t;this.itemSize=i;this.count=t!==void 0?t.length/i:0;this.normalized=e;this.usage=ei;this._updateRange={offset:0,count:-1};this.updateRanges=[];this.gpuType=gi;this.version=0}onUploadCallback(){}set needsUpdate(t){if(t===true)this.version++}get updateRange(){console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead.");return this._updateRange}setUsage(t){this.usage=t;return this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){this.name=t.name;this.array=new t.array.constructor(t.array);this.itemSize=t.itemSize;this.count=t.count;this.normalized=t.normalized;this.usage=t.usage;this.gpuType=t.gpuType;return this}copyAt(t,i,e){t*=this.itemSize;e*=i.itemSize;for(let s=0,n=this.itemSize;s<n;s++){this.array[t+s]=i.array[e+s]}return this}copyArray(t){this.array.set(t);return this}applyMatrix3(t){if(this.itemSize===2){for(let i=0,e=this.count;i<e;i++){Bt.fromBufferAttribute(this,i);Bt.applyMatrix3(t);this.setXY(i,Bt.x,Bt.y)}}else if(this.itemSize===3){for(let i=0,e=this.count;i<e;i++){B.fromBufferAttribute(this,i);B.applyMatrix3(t);this.setXYZ(i,B.x,B.y,B.z)}}return this}applyMatrix4(t){for(let i=0,e=this.count;i<e;i++){B.fromBufferAttribute(this,i);B.applyMatrix4(t);this.setXYZ(i,B.x,B.y,B.z)}return this}applyNormalMatrix(t){for(let i=0,e=this.count;i<e;i++){B.fromBufferAttribute(this,i);B.applyNormalMatrix(t);this.setXYZ(i,B.x,B.y,B.z)}return this}transformDirection(t){for(let i=0,e=this.count;i<e;i++){B.fromBufferAttribute(this,i);B.transformDirection(t);this.setXYZ(i,B.x,B.y,B.z)}return this}set(t,i=0){this.array.set(t,i);return this}getComponent(t,i){let e=this.array[t*this.itemSize+i];if(this.normalized)e=lt(e,this.array);return e}setComponent(t,i,e){if(this.normalized)e=I(e,this.array);this.array[t*this.itemSize+i]=e;return this}getX(t){let i=this.array[t*this.itemSize];if(this.normalized)i=lt(i,this.array);return i}setX(t,i){if(this.normalized)i=I(i,this.array);this.array[t*this.itemSize]=i;return this}getY(t){let i=this.array[t*this.itemSize+1];if(this.normalized)i=lt(i,this.array);return i}setY(t,i){if(this.normalized)i=I(i,this.array);this.array[t*this.itemSize+1]=i;return this}getZ(t){let i=this.array[t*this.itemSize+2];if(this.normalized)i=lt(i,this.array);return i}setZ(t,i){if(this.normalized)i=I(i,this.array);this.array[t*this.itemSize+2]=i;return this}getW(t){let i=this.array[t*this.itemSize+3];if(this.normalized)i=lt(i,this.array);return i}setW(t,i){if(this.normalized)i=I(i,this.array);this.array[t*this.itemSize+3]=i;return this}setXY(t,i,e){t*=this.itemSize;if(this.normalized){i=I(i,this.array);e=I(e,this.array)}this.array[t+0]=i;this.array[t+1]=e;return this}setXYZ(t,i,e,s){t*=this.itemSize;if(this.normalized){i=I(i,this.array);e=I(e,this.array);s=I(s,this.array)}this.array[t+0]=i;this.array[t+1]=e;this.array[t+2]=s;return this}setXYZW(t,i,e,s,n){t*=this.itemSize;if(this.normalized){i=I(i,this.array);e=I(e,this.array);s=I(s,this.array);n=I(n,this.array)}this.array[t+0]=i;this.array[t+1]=e;this.array[t+2]=s;this.array[t+3]=n;return this}onUpload(t){this.onUploadCallback=t;return this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};if(this.name!=="")t.name=this.name;if(this.usage!==ei)t.usage=this.usage;return t}}class qi extends ot{constructor(t,i,e){super(new Uint16Array(t),i,e)}}class Di extends ot{constructor(t,i,e){super(new Uint32Array(t),i,e)}}class Et extends ot{constructor(t,i,e){super(new Float32Array(t),i,e)}}let Wi=0;const N=new D;const Zt=new G;const ut=new p;const P=new dt;const pt=new dt;const E=new p;class Ht extends Ot{constructor(){super();this.isBufferGeometry=true;Object.defineProperty(this,"id",{value:Wi++});this.uuid=_t();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.morphTargetsRelative=false;this.groups=[];this.boundingBox=null;this.boundingSphere=null;this.drawRange={start:0,count:Infinity};this.userData={}}getIndex(){return this.index}setIndex(t){if(Array.isArray(t)){this.index=new(wi(t)?Di:qi)(t,1)}else{this.index=t}return this}getAttribute(t){return this.attributes[t]}setAttribute(t,i){this.attributes[t]=i;return this}deleteAttribute(t){delete this.attributes[t];return this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,i,e=0){this.groups.push({start:t,count:i,materialIndex:e})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t;this.drawRange.count=i}applyMatrix4(t){const i=this.attributes.position;if(i!==void 0){i.applyMatrix4(t);i.needsUpdate=true}const e=this.attributes.normal;if(e!==void 0){const n=new it().getNormalMatrix(t);e.applyNormalMatrix(n);e.needsUpdate=true}const s=this.attributes.tangent;if(s!==void 0){s.transformDirection(t);s.needsUpdate=true}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}return this}applyQuaternion(t){N.makeRotationFromQuaternion(t);this.applyMatrix4(N);return this}rotateX(t){N.makeRotationX(t);this.applyMatrix4(N);return this}rotateY(t){N.makeRotationY(t);this.applyMatrix4(N);return this}rotateZ(t){N.makeRotationZ(t);this.applyMatrix4(N);return this}translate(t,i,e){N.makeTranslation(t,i,e);this.applyMatrix4(N);return this}scale(t,i,e){N.makeScale(t,i,e);this.applyMatrix4(N);return this}lookAt(t){Zt.lookAt(t);Zt.updateMatrix();this.applyMatrix4(Zt.matrix);return this}center(){this.computeBoundingBox();this.boundingBox.getCenter(ut).negate();this.translate(ut.x,ut.y,ut.z);return this}setFromPoints(t){const i=[];for(let e=0,s=t.length;e<s;e++){const n=t[e];i.push(n.x,n.y,n.z||0)}this.setAttribute("position",new Et(i,3));return this}computeBoundingBox(){if(this.boundingBox===null){this.boundingBox=new dt}const t=this.attributes.position;const i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this);this.boundingBox.set(new p(-Infinity,-Infinity,-Infinity),new p(Infinity,Infinity,Infinity));return}if(t!==void 0){this.boundingBox.setFromBufferAttribute(t);if(i){for(let e=0,s=i.length;e<s;e++){const n=i[e];P.setFromBufferAttribute(n);if(this.morphTargetsRelative){E.addVectors(this.boundingBox.min,P.min);this.boundingBox.expandByPoint(E);E.addVectors(this.boundingBox.max,P.max);this.boundingBox.expandByPoint(E)}else{this.boundingBox.expandByPoint(P.min);this.boundingBox.expandByPoint(P.max)}}}}else{this.boundingBox.makeEmpty()}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}computeBoundingSphere(){if(this.boundingSphere===null){this.boundingSphere=new Ci}const t=this.attributes.position;const i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this);this.boundingSphere.set(new p,Infinity);return}if(t){const e=this.boundingSphere.center;P.setFromBufferAttribute(t);if(i){for(let n=0,u=i.length;n<u;n++){const h=i[n];pt.setFromBufferAttribute(h);if(this.morphTargetsRelative){E.addVectors(P.min,pt.min);P.expandByPoint(E);E.addVectors(P.max,pt.max);P.expandByPoint(E)}else{P.expandByPoint(pt.min);P.expandByPoint(pt.max)}}}P.getCenter(e);let s=0;for(let n=0,u=t.count;n<u;n++){E.fromBufferAttribute(t,n);s=Math.max(s,e.distanceToSquared(E))}if(i){for(let n=0,u=i.length;n<u;n++){const h=i[n];const r=this.morphTargetsRelative;for(let a=0,o=h.count;a<o;a++){E.fromBufferAttribute(h,a);if(r){ut.fromBufferAttribute(t,a);E.add(ut)}s=Math.max(s,e.distanceToSquared(E))}}}this.boundingSphere.radius=Math.sqrt(s);if(isNaN(this.boundingSphere.radius)){console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}computeTangents(){const t=this.index;const i=this.attributes;if(t===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const e=t.array;const s=i.position.array;const n=i.normal.array;const u=i.uv.array;const h=s.length/3;if(this.hasAttribute("tangent")===false){this.setAttribute("tangent",new ot(new Float32Array(4*h),4))}const r=this.getAttribute("tangent").array;const a=[],o=[];for(let w=0;w<h;w++){a[w]=new p;o[w]=new p}const l=new p,d=new p,c=new p,m=new L,y=new L,g=new L,x=new p,b=new p;function A(w,T,C){l.fromArray(s,w*3);d.fromArray(s,T*3);c.fromArray(s,C*3);m.fromArray(u,w*2);y.fromArray(u,T*2);g.fromArray(u,C*2);d.sub(l);c.sub(l);y.sub(m);g.sub(m);const R=1/(y.x*g.y-g.x*y.y);if(!isFinite(R))return;x.copy(d).multiplyScalar(g.y).addScaledVector(c,-y.y).multiplyScalar(R);b.copy(c).multiplyScalar(y.x).addScaledVector(d,-g.x).multiplyScalar(R);a[w].add(x);a[T].add(x);a[C].add(x);o[w].add(b);o[T].add(b);o[C].add(b)}let z=this.groups;if(z.length===0){z=[{start:0,count:e.length}]}for(let w=0,T=z.length;w<T;++w){const C=z[w];const R=C.start;const J=C.count;for(let F=R,$=R+J;F<$;F+=3){A(e[F+0],e[F+1],e[F+2])}}const M=new p,S=new p;const _=new p,tt=new p;function v(w){_.fromArray(n,w*3);tt.copy(_);const T=a[w];M.copy(T);M.sub(_.multiplyScalar(_.dot(T))).normalize();S.crossVectors(tt,T);const C=S.dot(o[w]);const R=C<0?-1:1;r[w*4]=M.x;r[w*4+1]=M.y;r[w*4+2]=M.z;r[w*4+3]=R}for(let w=0,T=z.length;w<T;++w){const C=z[w];const R=C.start;const J=C.count;for(let F=R,$=R+J;F<$;F+=3){v(e[F+0]);v(e[F+1]);v(e[F+2])}}}computeVertexNormals(){const t=this.index;const i=this.getAttribute("position");if(i!==void 0){let e=this.getAttribute("normal");if(e===void 0){e=new ot(new Float32Array(i.count*3),3);this.setAttribute("normal",e)}else{for(let d=0,c=e.count;d<c;d++){e.setXYZ(d,0,0,0)}}const s=new p,n=new p,u=new p;const h=new p,r=new p,a=new p;const o=new p,l=new p;if(t){for(let d=0,c=t.count;d<c;d+=3){const m=t.getX(d+0);const y=t.getX(d+1);const g=t.getX(d+2);s.fromBufferAttribute(i,m);n.fromBufferAttribute(i,y);u.fromBufferAttribute(i,g);o.subVectors(u,n);l.subVectors(s,n);o.cross(l);h.fromBufferAttribute(e,m);r.fromBufferAttribute(e,y);a.fromBufferAttribute(e,g);h.add(o);r.add(o);a.add(o);e.setXYZ(m,h.x,h.y,h.z);e.setXYZ(y,r.x,r.y,r.z);e.setXYZ(g,a.x,a.y,a.z)}}else{for(let d=0,c=i.count;d<c;d+=3){s.fromBufferAttribute(i,d+0);n.fromBufferAttribute(i,d+1);u.fromBufferAttribute(i,d+2);o.subVectors(u,n);l.subVectors(s,n);o.cross(l);e.setXYZ(d+0,o.x,o.y,o.z);e.setXYZ(d+1,o.x,o.y,o.z);e.setXYZ(d+2,o.x,o.y,o.z)}}this.normalizeNormals();e.needsUpdate=true}}normalizeNormals(){const t=this.attributes.normal;for(let i=0,e=t.count;i<e;i++){E.fromBufferAttribute(t,i);E.normalize();t.setXYZ(i,E.x,E.y,E.z)}}toNonIndexed(){function t(h,r){const a=h.array;const o=h.itemSize;const l=h.normalized;const d=new a.constructor(r.length*o);let c=0,m=0;for(let y=0,g=r.length;y<g;y++){if(h.isInterleavedBufferAttribute){c=r[y]*h.data.stride+h.offset}else{c=r[y]*o}for(let x=0;x<o;x++){d[m++]=a[c++]}}return new ot(d,o,l)}if(this.index===null){console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed.");return this}const i=new Ht;const e=this.index.array;const s=this.attributes;for(const h in s){const r=s[h];const a=t(r,e);i.setAttribute(h,a)}const n=this.morphAttributes;for(const h in n){const r=[];const a=n[h];for(let o=0,l=a.length;o<l;o++){const d=a[o];const c=t(d,e);r.push(c)}i.morphAttributes[h]=r}i.morphTargetsRelative=this.morphTargetsRelative;const u=this.groups;for(let h=0,r=u.length;h<r;h++){const a=u[h];i.addGroup(a.start,a.count,a.materialIndex)}return i}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};t.uuid=this.uuid;t.type=this.type;if(this.name!=="")t.name=this.name;if(Object.keys(this.userData).length>0)t.userData=this.userData;if(this.parameters!==void 0){const r=this.parameters;for(const a in r){if(r[a]!==void 0)t[a]=r[a]}return t}t.data={attributes:{}};const i=this.index;if(i!==null){t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)}}const e=this.attributes;for(const r in e){const a=e[r];t.data.attributes[r]=a.toJSON(t.data)}const s={};let n=false;for(const r in this.morphAttributes){const a=this.morphAttributes[r];const o=[];for(let l=0,d=a.length;l<d;l++){const c=a[l];o.push(c.toJSON(t.data))}if(o.length>0){s[r]=o;n=true}}if(n){t.data.morphAttributes=s;t.data.morphTargetsRelative=this.morphTargetsRelative}const u=this.groups;if(u.length>0){t.data.groups=JSON.parse(JSON.stringify(u))}const h=this.boundingSphere;if(h!==null){t.data.boundingSphere={center:h.center.toArray(),radius:h.radius}}return t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;const i={};this.name=t.name;const e=t.index;if(e!==null){this.setIndex(e.clone(i))}const s=t.attributes;for(const a in s){const o=s[a];this.setAttribute(a,o.clone(i))}const n=t.morphAttributes;for(const a in n){const o=[];const l=n[a];for(let d=0,c=l.length;d<c;d++){o.push(l[d].clone(i))}this.morphAttributes[a]=o}this.morphTargetsRelative=t.morphTargetsRelative;const u=t.groups;for(let a=0,o=u.length;a<o;a++){const l=u[a];this.addGroup(l.start,l.count,l.materialIndex)}const h=t.boundingBox;if(h!==null){this.boundingBox=h.clone()}const r=t.boundingSphere;if(r!==null){this.boundingSphere=r.clone()}this.drawRange.start=t.drawRange.start;this.drawRange.count=t.drawRange.count;this.userData=t.userData;return this}dispose(){this.dispatchEvent({type:"dispose"})}}class jt extends Ht{constructor(t=1,i=1,e=1,s=1){super();this.type="PlaneGeometry";this.parameters={width:t,height:i,widthSegments:e,heightSegments:s};const n=t/2;const u=i/2;const h=Math.floor(e);const r=Math.floor(s);const a=h+1;const o=r+1;const l=t/h;const d=i/r;const c=[];const m=[];const y=[];const g=[];for(let x=0;x<o;x++){const b=x*d-u;for(let A=0;A<a;A++){const z=A*l-n;m.push(z,-b,0);y.push(0,0,1);g.push(A/h);g.push(1-x/r)}}for(let x=0;x<r;x++){for(let b=0;b<h;b++){const A=b+a*x;const z=b+a*(x+1);const M=b+1+a*(x+1);const S=b+1+a*x;c.push(A,z,S);c.push(z,M,S)}}this.setIndex(c);this.setAttribute("position",new Et(m,3));this.setAttribute("normal",new Et(y,3));this.setAttribute("uv",new Et(g,2))}copy(t){super.copy(t);this.parameters=Object.assign({},t.parameters);return this}static fromJSON(t){return new jt(t.width,t.height,t.widthSegments,t.heightSegments)}}class Li extends V{constructor(t,i,e,s,n,u,h,r,a,o){o=o!==void 0?o:It;if(o!==It&&o!==ii){throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat")}if(e===void 0&&o===It)e=fi;if(e===void 0&&o===ii)e=_i;super(null,s,n,u,h,r,o,e,a);this.isDepthTexture=true;this.image={width:t,height:i};this.magFilter=h!==void 0?h:ti;this.minFilter=r!==void 0?r:ti;this.flipY=false;this.generateMipmaps=false;this.compareFunction=null}copy(t){super.copy(t);this.compareFunction=t.compareFunction;return this}toJSON(t){const i=super.toJSON(t);if(this.compareFunction!==null)i.compareFunction=this.compareFunction;return i}}const Yi=new Li(1,1);Yi.compareFunction=zi;if(typeof __THREE_DEVTOOLS__!=="undefined"){__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Jt}}))}if(typeof window!=="undefined"){if(window.__THREE__){console.warn("WARNING: Multiple instances of Three.js being imported.")}else{window.__THREE__=Jt}}const mi=1024;const Gt=new jt(16,16,mi-1,mi-1);const vt=Gt.attributes.position.array;const Xi=Gt.attributes.normal.array;function Vi(f){for(let t=0,i=0,e=vt.length;t<e;t++,i+=3)vt[i+2]=f[t]}self.addEventListener("message",f=>{Vi(f.data);Gt.computeVertexNormals(true);self.postMessage([vt,Xi])})})();
